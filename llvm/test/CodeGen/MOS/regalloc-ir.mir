# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
# RUN: llc -mtriple=mos -run-pass=greedy -verify-machineinstrs -o - %s | FileCheck %s
--- |
  define void @spill_static_gpr() norecurse {
    entry:
      ret void
  }
  define void @spill_static_Imag8() norecurse {
    entry:
      ret void
  }
  define void @spill_static_imag16() norecurse {
    entry:
      ret void
  }
---
---
name: spill_static_gpr
legalized: true
regBankSelected: true
tracksRegLiveness: true
body: |
  bb.0.entry:
    liveins: $a
    ; CHECK-LABEL: name: spill_static_gpr
    ; CHECK: liveins: $a
    ; CHECK: STabs_offset $a, %stack.0, 0 :: (store 1 into %stack.0)
    ; CHECK: JSR &fn, mos_csr
    ; CHECK: $a = LDabs_offset %stack.0, 0, implicit-def $nz :: (load 1 from %stack.0)
    ; CHECK: RTS implicit $a
    %0:gpr = COPY $a
    JSR &fn, mos_csr
    $a = COPY %0
    RTS implicit $a
...
---
name: spill_static_Imag8
legalized: true
regBankSelected: true
tracksRegLiveness: true
body: |
  bb.0.entry:
    liveins: $rc2, $rs2, $rs4
    ; CHECK-LABEL: name: spill_static_Imag8
    ; CHECK: liveins: $rc2, $rs2, $rs4
    ; CHECK: BUNDLE implicit-def dead %1, implicit $rc2 {
    ; CHECK:   [[COPY:%[0-9]+]]:gpr = COPY $rc2
    ; CHECK:   STabs_offset internal [[COPY]], %stack.0, 0 :: (store 1 into %stack.0)
    ; CHECK: }
    ; CHECK: JSR &fn, mos_csr
    ; CHECK: BUNDLE implicit-def dead %2, implicit-def $nz, implicit-def $n, implicit-def $z, implicit-def $rc2, implicit-def $rc2lsb {
    ; CHECK:   [[LDabs_offset:%[0-9]+]]:gpr = LDabs_offset %stack.0, 0, implicit-def $nz :: (load 1 from %stack.0)
    ; CHECK:   $rc2 = COPY internal [[LDabs_offset]]
    ; CHECK: }
    ; CHECK: RTS implicit $rc2, implicit $rs2, implicit $rs4
    %0:imag8 = COPY $rc2
    JSR &fn, mos_csr
    $rc2 = COPY %0
    RTS implicit $rc2, implicit $rs2, implicit $rs4
...
---
name: spill_static_imag16
legalized: true
regBankSelected: true
tracksRegLiveness: true
body: |
  bb.0.entry:
    liveins: $rs1, $rs2, $rs4
    ; CHECK-LABEL: name: spill_static_imag16
    ; CHECK: liveins: $rs1, $rs2, $rs4
    ; CHECK: BUNDLE implicit-def dead %1, implicit-def dead %2, implicit $rc2, implicit $rc3 {
    ; CHECK:   [[COPY:%[0-9]+]]:gpr = COPY $rc2
    ; CHECK:   STabs_offset internal [[COPY]], %stack.0, 0 :: (store 1 into %stack.0)
    ; CHECK:   [[COPY1:%[0-9]+]]:gpr = COPY $rc3
    ; CHECK:   STabs_offset internal [[COPY1]], %stack.0, 1 :: (store 1 into %stack.0 + 1)
    ; CHECK: }
    ; CHECK: JSR &fn, mos_csr
    ; CHECK: BUNDLE implicit-def dead %3, implicit-def $nz, implicit-def $n, implicit-def $z, implicit-def $rc2, implicit-def $rc2lsb, implicit-def dead %4, implicit-def $rc3, implicit-def $rc3lsb, implicit-def $rs1 {
    ; CHECK:   [[LDabs_offset:%[0-9]+]]:gpr = LDabs_offset %stack.0, 0, implicit-def $nz :: (load 1 from %stack.0)
    ; CHECK:   $rc2 = COPY internal [[LDabs_offset]]
    ; CHECK:   [[LDabs_offset1:%[0-9]+]]:gpr = LDabs_offset %stack.0, 1, implicit-def $nz :: (load 1 from %stack.0 + 1)
    ; CHECK:   $rc3 = COPY internal [[LDabs_offset1]]
    ; CHECK:   $rs1 = KILL internal $rc2, internal $rc3
    ; CHECK: }
    ; CHECK: RTS implicit $rs1, implicit $rs2, implicit $rs4
    %0:imag16 = COPY $rs1
    JSR &fn, mos_csr
    $rs1 = COPY %0
    RTS implicit $rs1, implicit $rs2, implicit $rs4
...
