# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
# RUN: llc -mtriple=mos -run-pass=scavenger-test -verify-machineinstrs -o - %s | FileCheck %s
---
name: scavenge_gpr
body: |
  bb.0.entry:
    liveins: $a
    ; CHECK-LABEL: name: scavenge_gpr
    ; CHECK: dead $x = LDImm 42
    ; CHECK: RTS implicit $a
    %0:gpr = LDImm 42
    RTS implicit $a
...
---
name: spill_a
body: |
  bb.0.entry:
    liveins: $a, $x, $y
    ; CHECK-LABEL: name: spill_a
    ; CHECK: PH $a
    ; CHECK: dead $a = LDImm 42
    ; CHECK: $a = PL
    ; CHECK: RTS implicit $a, implicit $x, implicit $y
    %0:gpr = LDImm 42
    RTS implicit $a, implicit $x, implicit $y
...
---
name: spill_a_around_pha
body: |
  bb.0.entry:
    liveins: $a, $x, $y
    ; CHECK-LABEL: name: spill_a_around_pha
    ; CHECK: STAbs $a, &__save_a
    ; CHECK: $a = LDImm 42
    ; CHECK: PH killed $a
    ; CHECK: $a = LDAbs &__save_a
    ; CHECK: RTS implicit $a, implicit $x, implicit $y
    %0:ac = LDImm 42
    PH %0
    RTS implicit $a, implicit $x, implicit $y
...
---
name: spill_a_around_pla
body: |
  bb.0.entry:
    liveins: $a, $x, $y
    ; CHECK-LABEL: name: spill_a_around_pla
    ; CHECK: STAbs $a, &__save_a
    ; CHECK: dead $a = PL
    ; CHECK: $a = LDAbs &__save_a
    ; CHECK: RTS implicit $a, implicit $x, implicit $y
    %0:ac = PL
    RTS implicit $a, implicit $x, implicit $y
...
---
name: spill_x
body: |
  bb.0.entry:
    liveins: $a, $x, $y
    ; CHECK-LABEL: name: spill_x
    ; CHECK: STAbs $x, &__save_x
    ; CHECK: dead $x = LDImm 42
    ; CHECK: $x = LDAbs &__save_x
    ; CHECK: RTS implicit $a, implicit $x, implicit $y
    %0:xy = LDImm 42
    RTS implicit $a, implicit $x, implicit $y
...
---
name: spill_y
body: |
  bb.0.entry:
    liveins: $a, $x, $y
    ; CHECK-LABEL: name: spill_y
    ; CHECK: STAbs $y, &__save_y
    ; CHECK: dead $y = LDImm 42
    ; CHECK: $y = LDAbs &__save_y
    ; CHECK: RTS implicit $a, implicit $x, implicit $y
    %0:yc = LDImm 42
    RTS implicit $a, implicit $x, implicit $y
...
---
name: spill_c
body: |
  bb.0.entry:
    liveins: $c
    ; CHECK-LABEL: name: spill_c
    ; CHECK: PH undef $p, implicit $c
    ; CHECK: dead $p = COPY $a
    ; CHECK: $p = PL
    ; CHECK: RTS implicit $c
    %0:pc = COPY $a
    RTS implicit $c
...
---
name: spill_v
body: |
  bb.0.entry:
    liveins: $v
    ; CHECK-LABEL: name: spill_v
    ; CHECK: PH undef $p, implicit $v
    ; CHECK: dead $p = COPY $a
    ; CHECK: $p = PL
    ; CHECK: RTS implicit $v
    %0:pc = COPY $a
    RTS implicit $v
...
---
name: spill_cv
body: |
  bb.0.entry:
    liveins: $c, $v
    ; CHECK-LABEL: name: spill_cv
    ; CHECK: PH $p
    ; CHECK: dead $p = COPY $a
    ; CHECK: $p = PL
    ; CHECK: RTS implicit $c, implicit $v
    %0:pc = COPY $a
    RTS implicit $c, implicit $v
...
