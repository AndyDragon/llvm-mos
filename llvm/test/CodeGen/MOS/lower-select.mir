# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
# RUN: llc -mtriple=mos -run-pass=mos-lower-select -verify-machineinstrs -o - %s | FileCheck %s
---
name: lower_select
legalized: true
regBankSelected: true
tracksRegLiveness: true
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: lower_select
    ; CHECK: successors: %bb.1(0x40000000), %bb.2(0x40000000)
    ; CHECK: [[C:%[0-9]+]]:any(s8) = G_CONSTANT i8 1
    ; CHECK: [[C1:%[0-9]+]]:any(s8) = G_CONSTANT i8 2
    ; CHECK: [[C2:%[0-9]+]]:any(s1) = G_CONSTANT i1 false
    ; CHECK: G_BRCOND_IMM [[C2]](s1), %bb.2, 1
    ; CHECK: .1.entry:
    ; CHECK: successors: %bb.2(0x80000000)
    ; CHECK: .2.entry:
    ; CHECK: successors: %bb.3(0x40000000), %bb.4(0x40000000)
    ; CHECK: [[PHI:%[0-9]+]]:any(s8) = G_PHI [[C]](s8), %bb.0, [[C1]](s8), %bb.1
    ; CHECK: [[C3:%[0-9]+]]:any(s8) = G_CONSTANT i8 3
    ; CHECK: G_BRCOND_IMM [[C2]](s1), %bb.4, 1
    ; CHECK: .3.entry:
    ; CHECK: successors: %bb.4(0x80000000)
    ; CHECK: .4.entry:
    ; CHECK: [[PHI1:%[0-9]+]]:any(s8) = G_PHI [[C1]](s8), %bb.2, [[C]](s8), %bb.3
    ; CHECK: RTS implicit [[PHI]](s8), implicit [[C3]](s8), implicit [[PHI1]](s8)
    %0:any(s8) = G_CONSTANT i8 1
    %1:any(s8) = G_CONSTANT i8 2
    %2:any(s1) = G_CONSTANT i1 false
    %3:any(s8) = G_SELECT %2, %0, %1
    %4:any(s8) = G_CONSTANT i8 3
    %5:any(s8) = G_SELECT %2, %1, %0
    RTS implicit %3, implicit %4, implicit %5
...
---
name: lower_select_around_call
legalized: true
regBankSelected: true
tracksRegLiveness: true
body: |
  bb.0.entry:
    ADJCALLSTACKDOWN 0, 0, implicit-def $rs0, implicit $rs0
    %0:any(s8) = G_CONSTANT i8 0
    $a = COPY %0
    %1:any(s8) = G_CONSTANT i8 1
    %2:any(s8) = G_CONSTANT i8 2
    %3:any(s8) = G_CONSTANT i8 3
    %4:any(s1) = G_CONSTANT i1 false
    %5:any(s8) = G_SELECT %4, %1, %2
    $y = COPY %5
    JSR &fn
    ADJCALLSTACKUP 0, 0, implicit-def $rs0, implicit $rs0
    RTS
...




