# RUN: llc -run-pass=irtranslator -verify-machineinstrs -num-imag-ptrs=3 -o - %s | FileCheck %s
--- |
  ; Note that -num-imag-ptrs=3, forcing use of the stack for long argument lists.
  target triple = "mos"

  define void @args_stack(i8 %first, i8 %second, i16 %third, i16 %stack) {
  ; CHECK-LABEL: name: args_stack
  entry:
  ; CHECK-LABEL: entry:
    ; CHECK-NEXT: liveins: $a, $x, $rc2, $rc3
    ; CHECK:      %0:_(s8) = COPY $a
    ; CHECK-NEXT: %1:_(s8) = COPY $x
    ; CHECK-NEXT: %4:_(s8) = COPY $rc2
    ; CHECK-NEXT: %5:_(s8) = COPY $rc3
    ; CHECK-NEXT: %2:_(s16) = G_MERGE_VALUES %4(s8), %5(s8)

    ; CHECK-NEXT: %8:_(p0) = G_FRAME_INDEX %fixed-stack.1
    ; CHECK-NEXT: %6:_(s8) = G_LOAD %8(p0) :: (invariant load 1 from %fixed-stack.1)

    ; CHECK-NEXT: %9:_(p0) = G_FRAME_INDEX %fixed-stack.0
    ; CHECK-NEXT: %7:_(s8) = G_LOAD %9(p0) :: (invariant load 1 from %fixed-stack.0)

    ; CHECK-NEXT: %3:_(s16) = G_MERGE_VALUES %6(s8), %7(s8)

    ret void
    ; CHECK-NEXT: RTS
  }

  define void @call_args_stack() {
    ; CHECK-LABEL: name: call_args_stack

    call void @args_stack(i8 1, i8 2, i16 3, i16 4)
    ; CHECK:      %0:_(s8) = G_CONSTANT i8 1
    ; CHECK-NEXT: %1:_(s8) = G_CONSTANT i8 2
    ; CHECK-NEXT: %2:_(s16) = G_CONSTANT i16 3
    ; CHECK-NEXT: %3:_(s16) = G_CONSTANT i16 4

    ; CHECK-NEXT: ADJCALLSTACKDOWN 2, 0

    ; CHECK-NEXT: $a = COPY %0(s8)
    ; CHECK-NEXT: $x = COPY %1(s8)

    ; CHECK-NEXT: %4:_(s8), %5:_(s8) = G_UNMERGE_VALUES %2(s16)
    ; CHECK-NEXT: $rc2 = COPY %4(s8)
    ; CHECK-NEXT: $rc3 = COPY %5(s8)

    ; CHECK-NEXT: %6:_(s8), %7:_(s8) = G_UNMERGE_VALUES %3(s16)

    ; CHECK-NEXT: %8:_(p0) = COPY $rs0
    ; CHECK-NEXT: %9:_(s16) = G_CONSTANT i16 0
    ; CHECK-NEXT: %10:_(p0) = G_PTR_ADD %8, %9(s16)
    ; CHECK-NEXT: G_STORE %6(s8), %10(p0) :: (store 1 into stack)

    ; CHECK-NEXT: %11:_(s16) = G_CONSTANT i16 1
    ; CHECK-NEXT: %12:_(p0) = G_PTR_ADD %8, %11(s16)
    ; CHECK-NEXT: G_STORE %7(s8), %12(p0) :: (store 1 into stack + 1)

    ; CHECK-NEXT: JSR @args_stack

    ; CHECK-NEXT: ADJCALLSTACKUP 2, 0

    ret void
    ; CHECK-NEXT: RTS
  }
...
