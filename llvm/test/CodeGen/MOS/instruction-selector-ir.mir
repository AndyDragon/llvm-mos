# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
# RUN: llc -mtriple=mos -run-pass=instruction-select -verify-machineinstrs -o - %s | FileCheck %s
--- |
  @.str = constant [1 x i8] c"X"
  define void @addrstk_fixed() norecurse {
    entry:
      ret void
  }
  define void @addrstk_local() {
    entry:
      ret void
  }
  define void @ldimm_local() norecurse {
    entry:
      ret void
  }
  define void @ldimm_global() {
    entry:
      ret void
  }
  define void @ldimm_global_offset() {
    entry:
      ret void
  }
  define void @load_absolute_const() {
    entry:
      ret void
  }
  define void @load_absolute_gv() {
    entry:
      ret void
  }
  define void @load_indexed() {
    entry:
      ret void
  }
  define void @load_volatile_not_indexed() {
    entry:
      ret void
  }
  define void @store_indexed() {
    entry:
      ret void
  }
---
name: addrstk_fixed
legalized: true
regBankSelected: true
fixedStack:
  - { id: 0, size: 1 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: addrstk_fixed
    ; CHECK: [[AddrLostk:%[0-9]+]]:anyi8, [[AddrLostk1:%[0-9]+]]:cc, [[AddrLostk2:%[0-9]+]]:vc = AddrLostk %fixed-stack.0, 0
    ; CHECK: [[AddrHistk:%[0-9]+]]:anyi8, [[AddrHistk1:%[0-9]+]]:cc, [[AddrHistk2:%[0-9]+]]:vc = AddrHistk %fixed-stack.0, 0, [[AddrLostk1]]
    ; CHECK: [[REG_SEQUENCE:%[0-9]+]]:imag16 = REG_SEQUENCE [[AddrLostk]], %subreg.sublo, [[AddrHistk]], %subreg.subhi
    ; CHECK: RTS implicit [[REG_SEQUENCE]]
    %0:any(p0) = G_FRAME_INDEX %fixed-stack.0
    RTS implicit %0
# Note: The HI and LO target operands are present on the frame index, but LLVM doesn't print them.
...
---
name: addrstk_local
legalized: true
regBankSelected: true
stack:
  - { id: 0, size: 1 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: addrstk_local
    ; CHECK: [[AddrLostk:%[0-9]+]]:anyi8, [[AddrLostk1:%[0-9]+]]:cc, [[AddrLostk2:%[0-9]+]]:vc = AddrLostk %stack.0, 0
    ; CHECK: [[AddrHistk:%[0-9]+]]:anyi8, [[AddrHistk1:%[0-9]+]]:cc, [[AddrHistk2:%[0-9]+]]:vc = AddrHistk %stack.0, 0, [[AddrLostk1]]
    ; CHECK: [[REG_SEQUENCE:%[0-9]+]]:imag16 = REG_SEQUENCE [[AddrLostk]], %subreg.sublo, [[AddrHistk]], %subreg.subhi
    ; CHECK: RTS implicit [[REG_SEQUENCE]]
    %0:any(p0) = G_FRAME_INDEX %stack.0
    RTS implicit %0
# Note: The HI and LO target operands are present on the frame index, but LLVM doesn't print them.
...
---
name: ldimm_local
legalized: true
regBankSelected: true
stack:
  - { id: 0, size: 1 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: ldimm_local
    ; CHECK: [[LDImm:%[0-9]+]]:gpr = LDImm %stack.0
    ; CHECK: [[LDImm1:%[0-9]+]]:gpr = LDImm %stack.0
    ; CHECK: [[REG_SEQUENCE:%[0-9]+]]:imag16 = REG_SEQUENCE [[LDImm]], %subreg.sublo, [[LDImm1]], %subreg.subhi
    ; CHECK: RTS implicit [[REG_SEQUENCE]]
    %0:any(p0) = G_FRAME_INDEX %stack.0
    RTS implicit %0
# Note: The HI and LO target operands are present on the frame index, but LLVM doesn't print them.
...
---
name: ldimm_global
legalized: true
regBankSelected: true
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: ldimm_global
    ; CHECK: [[LDImm:%[0-9]+]]:gpr = LDImm target-flags(lo) @.str
    ; CHECK: [[LDImm1:%[0-9]+]]:gpr = LDImm target-flags(hi) @.str
    ; CHECK: [[REG_SEQUENCE:%[0-9]+]]:imag16 = REG_SEQUENCE [[LDImm]], %subreg.sublo, [[LDImm1]], %subreg.subhi
    ; CHECK: RTS implicit [[REG_SEQUENCE]]
    %0:any(p0) = G_GLOBAL_VALUE @.str
    RTS implicit %0
...
---
name: ldimm_global_offset
legalized: true
regBankSelected: true
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: ldimm_global_offset
    ; CHECK: [[LDImm:%[0-9]+]]:gpr = LDImm target-flags(lo) @.str + 1234
    ; CHECK: [[LDImm1:%[0-9]+]]:gpr = LDImm target-flags(hi) @.str + 1234
    ; CHECK: [[REG_SEQUENCE:%[0-9]+]]:imag16 = REG_SEQUENCE [[LDImm]], %subreg.sublo, [[LDImm1]], %subreg.subhi
    ; CHECK: RTS implicit [[REG_SEQUENCE]]
    %0:any(p0) = G_GLOBAL_VALUE @.str + 1234
    RTS implicit %0
...
---
name: load_absolute_const
legalized: true
regBankSelected: true
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: load_absolute_const
    ; CHECK: [[LDAbs:%[0-9]+]]:gpr = LDAbs 1234 :: (load 1)
    ; CHECK: RTS implicit [[LDAbs]]
    %0:any(s16) = G_CONSTANT i16 1234
    %1:any(p0) = G_INTTOPTR %0
    %2:any(s8) = G_LOAD %1 :: (load 1)
    RTS implicit %2
...
---
name: load_absolute_gv
legalized: true
regBankSelected: true
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: load_absolute_gv
    ; CHECK: [[LDAbs:%[0-9]+]]:gpr = LDAbs @.str :: (load 1)
    ; CHECK: RTS implicit [[LDAbs]]
    %0:any(p0) = G_GLOBAL_VALUE @.str
    %1:any(s8) = G_LOAD %0 :: (load 1)
    RTS implicit %1
...
---
name: load_indexed
legalized: true
regBankSelected: true
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: load_indexed
    ; CHECK: [[COPY:%[0-9]+]]:xy = COPY $a
    ; CHECK: [[LDIdx:%[0-9]+]]:gpr = LDIdx @.str, [[COPY]] :: (load 1)
    ; CHECK: RTS implicit [[LDIdx]]
    %0:any(p0) = G_GLOBAL_VALUE @.str
    %1:any(s8) = COPY $a
    %2:any(p0) = G_INDEX %0, %1
    %3:any(s8) = G_LOAD %2 :: (load 1)
    RTS implicit %3
...
---
name: load_volatile_not_indexed
legalized: true
regBankSelected: true
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: load_volatile_not_indexed
    ; CHECK: [[LDImm:%[0-9]+]]:gpr = LDImm target-flags(lo) @.str
    ; CHECK: [[LDImm1:%[0-9]+]]:gpr = LDImm target-flags(hi) @.str
    ; CHECK: [[REG_SEQUENCE:%[0-9]+]]:imag16 = REG_SEQUENCE [[LDImm]], %subreg.sublo, [[LDImm1]], %subreg.subhi
    ; CHECK: [[COPY:%[0-9]+]]:imag8 = COPY $a
    ; CHECK: [[COPY1:%[0-9]+]]:ac = COPY [[LDImm]]
    ; CHECK: [[COPY2:%[0-9]+]]:ac = COPY [[LDImm1]]
    ; CHECK: [[LDImm1_:%[0-9]+]]:cc = LDImm1 0
    ; CHECK: [[ADCImag8_:%[0-9]+]]:ac, [[ADCImag8_1:%[0-9]+]]:cc, [[ADCImag8_2:%[0-9]+]]:vc = ADCImag8 [[COPY1]], [[COPY]], [[LDImm1_]]
    ; CHECK: [[ADCImm:%[0-9]+]]:ac, [[ADCImm1:%[0-9]+]]:cc, [[ADCImm2:%[0-9]+]]:vc = ADCImm [[COPY2]], 0, [[ADCImag8_1]]
    ; CHECK: [[REG_SEQUENCE1:%[0-9]+]]:imag16 = REG_SEQUENCE [[ADCImag8_]], %subreg.sublo, [[ADCImm]], %subreg.subhi
    ; CHECK: [[LDImm2:%[0-9]+]]:yc = LDImm 0
    ; CHECK: [[LDYIndir:%[0-9]+]]:ac = LDYIndir [[REG_SEQUENCE1]], [[LDImm2]] :: (volatile load 1)
    ; CHECK: RTS implicit [[LDYIndir]]
    %0:any(p0) = G_GLOBAL_VALUE @.str
    %1:any(s8) = COPY $a
    %2:any(p0) = G_INDEX %0, %1
    %3:any(s8) = G_LOAD %2 :: (volatile load 1)
    RTS implicit %3
...
---
name: store_indexed
legalized: true
regBankSelected: true
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: store_indexed
    ; CHECK: [[COPY:%[0-9]+]]:ac = COPY $x
    ; CHECK: [[COPY1:%[0-9]+]]:xy = COPY $a
    ; CHECK: STIdx [[COPY]], @.str, [[COPY1]] :: (store 1)
    ; CHECK: RTS
    %0:any(s8) = COPY $x
    %1:any(p0) = G_GLOBAL_VALUE @.str
    %2:any(s8) = COPY $a
    %3:any(p0) = G_INDEX %1, %2
    G_STORE %0, %3 :: (store 1)
    RTS
...
